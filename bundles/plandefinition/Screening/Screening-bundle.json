{
  "resourceType": "Bundle",
  "id": "Screening-bundle",
  "type": "transaction",
  "entry": [ {
    "resource": {
      "resourceType": "Patient",
      "id": "HighRiskSTDPatient",
      "meta": {
        "profile": [ "http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-patient" ]
      },
      "identifier": [ {
        "use": "usual",
        "type": {
          "coding": [ {
            "system": "http://terminology.hl7.org/CodeSystem/v2-0203",
            "code": "MR"
          } ]
        },
        "system": "urn:oid:1.2.36.146.595.217.0.1",
        "value": "12345",
        "period": {
          "start": "2001-05-06"
        },
        "assigner": {
          "display": "Acme Healthcare"
        }
      } ],
      "active": true,
      "name": [ {
        "use": "official",
        "family": "Jones",
        "given": [ "John" ]
      } ],
      "gender": "male",
      "birthDate": "1982-08-08",
      "deceasedBoolean": false
    },
    "request": {
      "method": "PUT",
      "url": "Patient/HighRiskSTDPatient"
    }
  }, {
    "resource": {
      "resourceType": "Encounter",
      "id": "MSMPatient-encounter-1",
      "meta": {
        "profile": [ "http://fhir.org/guides/nachc/hiv-cds/StructureDefinition/nachc-a0-de1" ]
      },
      "status": "in-progress",
      "class": {
        "system": "http://terminology.hl7.org/CodeSystem/v3-ActCode",
        "code": "AMB",
        "display": "ambulatory"
      },
      "type": [ {
        "coding": [ {
          "system": "http://fhir.org/guides/nachc/hiv-cds/CodeSystem/hiv-custom",
          "code": "Patient Encounter-99205",
          "display": "99205"
        } ]
      } ],
      "subject": {
        "reference": "Patient/MSMPatient"
      },
      "period": {
        "start": "2021-07-31T10:00:00-07:00",
        "end": "2021-07-31T11:20:00-07:00"
      }
    },
    "request": {
      "method": "PUT",
      "url": "Encounter/MSMPatient-encounter-1"
    }
  }, {
    "resource": {
      "resourceType": "Library",
      "id": "Screening",
      "extension": [ {
        "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-softwaresystem",
        "valueReference": {
          "reference": "Device/cqf-tooling"
        }
      } ],
      "url": "http://fhir.org/guides/nachc/hiv-cds/Library/Screening",
      "name": "Screening",
      "title": "Library - HIV Screening",
      "type": {
        "coding": [ {
          "system": "http://hl7.org/fhir/ValueSet/library-type",
          "version": "4.0.1",
          "code": "logic-library",
          "display": "Logic Library"
        } ]
      },
      "subjectCodeableConcept": {
        "coding": [ {
          "system": "http://hl7.org/fhir/ValueSet/subject-type",
          "version": "4.0.1",
          "code": "Patient",
          "display": "Patient"
        } ]
      },
      "date": "2021-05-12T00:00:00-07:00",
      "publisher": "National Association of Community Health Centers, Inc. (NACHC)",
      "contact": [ {
        "telecom": [ {
          "system": "url",
          "value": "https://www.nachc.org/"
        } ]
      } ],
      "description": "Logic library for implementation of the CDC HIV Screening Recommendation.",
      "useContext": [ {
        "code": {
          "system": "http://hl7.org/fhir/usage-context-type",
          "version": "4.0.1",
          "code": "focus",
          "display": "Clinical Focus"
        },
        "valueCodeableConcept": {
          "coding": [ {
            "system": "http://hl7.org/fhir/sid/icd-10-cm",
            "version": "2021",
            "code": "B20",
            "display": "Human immunodeficiency virus [HIV] disease"
          } ]
        }
      } ],
      "jurisdiction": [ {
        "coding": [ {
          "system": "http://hl7.org/fhir/ValueSet/iso3166-1-3",
          "version": "4.0.1",
          "code": "USA",
          "display": "United States of America"
        } ]
      } ],
      "purpose": "The purpose of this is to implement a Clinical Decision Support Workflow via CDS-Hooks to establish the CDC's HIV Screening Recommendation.",
      "usage": "This is to be used in conjunction with a patient-facing FHIR application.",
      "copyright": "© Copyright National Association of Community Health Centers, Inc. (NACHC) 2021+.",
      "topic": [ {
        "coding": [ {
          "system": "http://hl7.org/fhir/ValueSet/definition-topic",
          "version": "4.0.1",
          "code": "assessment",
          "display": "Assessment"
        } ],
        "text": "HIV Management"
      } ],
      "content": [ {
        "contentType": "text/cql",
        "data": "bGlicmFyeSBTY3JlZW5pbmcNCg0KdXNpbmcgRkhJUiB2ZXJzaW9uICc0LjAuMScNCg0KaW5jbHVkZSBGSElSSGVscGVycyB2ZXJzaW9uICc0LjAuMScNCmluY2x1ZGUgRkhJUkNvbW1vbiBjYWxsZWQgRkMNCg0KaW5jbHVkZSBOQUNIQ0NvbW1vbiBjYWxsZWQgTkMNCmluY2x1ZGUgSElWQ29tbW9uIGNhbGxlZCBIQw0KaW5jbHVkZSBISVZDb25jZXB0cyBjYWxsZWQgQ3gNCg0KaW5jbHVkZSBISVZEYXRhRWxlbWVudHMgY2FsbGVkIEhERQ0KDQpjb250ZXh0IFBhdGllbnQNCg0KZGVmaW5lICJJbmZvIjoNCiAgJ2luZm8nDQoNCmRlZmluZSAiV2FybmluZyI6DQogICd3YXJuaW5nJw0KDQpkZWZpbmUgIkNyaXRpY2FsIjoNCiAgJ2NyaXRpY2FsJw0KDQpkZWZpbmUgIkVycm9ycyI6DQogIG51bGwNCg0KZGVmaW5lICJQYXRpZW50IE5hbWUiOg0KICBGaXJzdChQYXRpZW50Lm5hbWUuZ2l2ZW4pDQogICArICcgJyArDQogIEZpcnN0KFBhdGllbnQubmFtZS5mYW1pbHkpDQoNCg0KLyogUmVjb21tZW5kYXRpb24gQ3JpdGVyaWEgLSBISVYgU2NyZWVuaW5nICAqLw0KZGVmaW5lICJNZWV0cyBJbmNsdXNpb24gQ3JpdGVyaWEiOg0KICJQYXRpZW50IGlzIGJldHdlZW4gMTMgYW5kIDY0IHllYXJzIG9sZCINCiBvciAiUGF0aWVudCBpcyBTZWVraW5nIFRyZWF0bWVudCBmb3IgYW4gU1REIg0KDQpkZWZpbmUgIk1lZXRzIEV4Y2x1c2lvbiBDcml0ZXJpYSI6DQogICJBY3RpdmUgRGlhZ25vc2lzIG9mIEhJViBEdXJpbmcgUGF0aWVudCBWaXNpdCIgaXMgbm90IG51bGwNCg0KZGVmaW5lICJJbiBQb3B1bGF0aW9uIjoNCiAgIk1lZXRzIEluY2x1c2lvbiBDcml0ZXJpYSINCiAgYW5kIG5vdCAiTWVldHMgRXhjbHVzaW9uIENyaXRlcmlhIg0KDQovKiBPUFRJT05TOg0KICAgIDEuIFJlY29tbWVuZCBTY3JlZW5pbmcgTm93DQogICAgMi4gUmVjb21tZW5kIFNjcmVlbmluZyBPbmNlDQogICAgMy4gUmVjb21tZW5kIFNjcmVlbmluZyBBbnVhbGx5DQogICAgNC4gUmVjb21tZW5kIFNjcmVlbmluZyBNb3JlIE9mdGVuICgzIG1vbnRocyBiYXNlZCBvbiBzcGVjaWZpYyByaXNrIGZhY3RvciAtLSBzZXh1YWxseSBhY3RpdmUgTVNNIHcvIHByZXApDQoqLw0KZGVmaW5lICJSZWNvbW1lbmRhdGlvbiI6DQogIGlmICJQYXRpZW50IGlzIGEgU2V4dWFsbHkgQWN0aXZlIE1TTSB3aG8gc2hvdWxkIGJlIFNjcmVlbmVkIEV2ZXJ5IDMgTW9udGhzIiB0aGVuICdUaHJlZSBNb250aCBISVYgU2NyZWVuaW5nIFJlY29tbWVuZGVkIGR1ZSB0byBwYXRpZW50IGJlaW5nIGEgc2V4dWFsbHkgYWN0aXZlIE1TTSB3aG8gaGFzIGJlZW4gcHJlc2NyaWJlZCBQckVQIGluIHRoZSBwYXN0LicNCiAgZWxzZSBpZiAiUGF0aWVudCBpcyBhIFNleHVhbGx5IEFjdGl2ZSBNU00gd2hvIHNob3VsZCBiZSBTY3JlZW5lZCBBbm51YWxseSIgdGhlbiAnQW5udWFsIEhJViBTY3JlZW5pbmcgUmVjb21tZW5kZWQgZHVlIHRvIHBhdGllbnQgYmVpbmcgYSBzZXh1YWxseSBhY3RpdmUgTVNNIHdpdGhvdXQgSElWIGFuZCBoYXMgaGFkIG11bHRpcGxlIHNleCBwYXJ0bmVycy4nDQogIGVsc2UgaWYgIlBhdGllbnQgaXMgYXQgRmlyc3QgUHJlbmF0YWwgVmlzaXQiIHRoZW4gJ0hJViBTY3JlZW5pbmcgUmVjb21tZW5kZWQgbm93IGR1ZSB0byBwYXRpZW50IGJlaW5nIGF0IGZpcnN0IHByZW5hdGFsIHZpc2l0LicNCiAgZWxzZSBpZiAiUGF0aWVudCBpcyBIaWdoIFJpc2sgaW4gVGhpcmQgVHJpbWVzdGVyIG9mIFByZWduYW5jeSIgdGhlbiAnSElWIFNjcmVlbmluZyBSZWNvbW1lbmRlZCBkdWUgdG8gcGF0aWVudCBiZWluZyBhdCBoaWdoIHJpc2sgb2YgSElWIGR1cmluZyB0aGlyZCB0cmltZXN0ZXIgb2YgcHJlZ25hbmN5LicNCiAgZWxzZSBpZiAiUGF0aWVudCBpcyBTZWVraW5nIFRyZWF0bWVudCBmb3IgYW4gU1REIiB0aGVuICdISVYgU2NyZWVuaW5nIFJlY29tbWVuZGVkIG5vdyBkdWUgdG8gcGF0aWVudCBpbnRlcmVzdC4nDQogIGVsc2UgaWYgbm90ICJQYXRpZW50IGhhcyBoYWQgYW4gSElWIFNjcmVlbmluZyIgdGhlbiAnSElWIFNjcmVlbmluZyBSZWNvbW1lbmRlZCBvbmNlIGR1ZSB0byBwYXRpZW50IG5ldmVyIGhhdmluZyBiZWVuIHRlc3RlZC4nDQogIGVsc2UgJ0hJViBTY3JlZW5pbmcgaXMgbm90IGN1cnJlbnRseSBSZWNvbW1lbmRlZCBmb3IgdGhpcyBwYXRpZW50LicNCg0KLyogUmF0aW9uYWwgYmFzZWQgb24gUmVjb21tZW5kYXRpb24gT3B0aW9uIChSZWZlcmVuY2VzIHRvIENEQyBSZWNvbW1lbmRhdGlvbnMpICovDQpkZWZpbmUgIlJhdGlvbmFsZSI6DQogIGlmICJQYXRpZW50IGlzIGEgU2V4dWFsbHkgQWN0aXZlIE1TTSB3aG8gc2hvdWxkIGJlIFNjcmVlbmVkIEV2ZXJ5IDMgTW9udGhzIiB0aGVuICdGb3IgTVNNIHdobyBhcmUgcHJlc2NyaWJlZCBwcmVleHBvc3VyZSBwcm9waHlsYXhpcywgSElWIHRlc3RpbmcgZXZlcnkgMyBtb250aHMgYW5kIGltbWVkaWF0ZSB0ZXN0aW5nIHdoZW5ldmVyIHNpZ25zIGFuZCBzeW1wdG9tcyBvZiBhY3V0ZSBISVYgaW5mZWN0aW9uIGFyZSByZXBvcnRlZCBpcyBpbmRpY2F0ZWQuJw0KICBlbHNlIGlmICJQYXRpZW50IGlzIGEgU2V4dWFsbHkgQWN0aXZlIE1TTSB3aG8gc2hvdWxkIGJlIFNjcmVlbmVkIEFubnVhbGx5IiB0aGVuICdBbW9uZyB5b3VuZyAoYWdlZCAxOC0tMjQgeWVhcnMpIG1lbiB3aG8gaGF2ZSBzZXggd2l0aCBtZW4gKE1TTSkgc3VydmV5ZWQgZHVyaW5nIDIwMDQtLTIwMDUgaW4gZml2ZSBVLlMuIGNpdGllcywgMTQlIHdlcmUgaW5mZWN0ZWQgd2l0aCBISVY7IDc5JSBvZiB0aGVzZSBISVYtaW5mZWN0ZWQgTVNNIHdlcmUgdW5hd2FyZSBvZiB0aGVpciBpbmZlY3Rpb24uJw0KICBlbHNlIGlmICJQYXRpZW50IGlzIGF0IEZpcnN0IFByZW5hdGFsIFZpc2l0IiB0aGVuICdUbyBwcm9tb3RlIGluZm9ybWVkIGFuZCB0aW1lbHkgdGhlcmFwZXV0aWMgZGVjaXNpb25zLCBoZWFsdGgtY2FyZSBwcm92aWRlcnMgc2hvdWxkIHRlc3Qgd29tZW4gZm9yIEhJViBhcyBlYXJseSBhcyBwb3NzaWJsZSBkdXJpbmcgZWFjaCBwcmVnbmFuY3kuIFdvbWVuIHdobyBkZWNsaW5lIHRoZSB0ZXN0IGVhcmx5IGluIHByZW5hdGFsIGNhcmUgc2hvdWxkIGJlIGVuY291cmFnZWQgdG8gYmUgdGVzdGVkIGF0IGEgc3Vic2VxdWVudCB2aXNpdC4nDQogIGVsc2UgaWYgIlBhdGllbnQgaXMgSGlnaCBSaXNrIGluIFRoaXJkIFRyaW1lc3RlciBvZiBQcmVnbmFuY3kiIHRoZW4gJ0Egc2Vjb25kIEhJViB0ZXN0IGR1cmluZyB0aGUgdGhpcmQgdHJpbWVzdGVyIGZvciB3b21lbiBpbiBzZXR0aW5ncyB3aXRoIGVsZXZhdGVkIEhJViBpbmNpZGVuY2UgKD4xNyBjYXNlcyBwZXIgMTAwLDAwMCBwZXJzb24teWVhcnMpIGlzIGNvc3QtZWZmZWN0aXZlIGFuZCBtaWdodCByZXN1bHQgaW4gc3Vic3RhbnRpYWwgcmVkdWN0aW9ucyBpbiBtb3RoZXItdG8tY2hpbGQgSElWIHRyYW5zbWlzc2lvbi4nDQogIGVsc2UgaWYgIlBhdGllbnQgaXMgU2Vla2luZyBUcmVhdG1lbnQgZm9yIGFuIFNURCIgdGhlbiAnQWxsIHBhdGllbnRzIHNlZWtpbmcgdHJlYXRtZW50IGZvciBTVERzLCBpbmNsdWRpbmcgYWxsIHBhdGllbnRzIGF0dGVuZGluZyBTVEQgY2xpbmljcywgc2hvdWxkIGJlIHNjcmVlbmVkIHJvdXRpbmVseSBmb3IgSElWIGR1cmluZyBlYWNoIHZpc2l0IGZvciBhIG5ldyBjb21wbGFpbnQsIHJlZ2FyZGxlc3Mgb2Ygd2hldGhlciB0aGUgcGF0aWVudCBpcyBrbm93biBvciBzdXNwZWN0ZWQgdG8gaGF2ZSBzcGVjaWZpYyBiZWhhdmlvciByaXNrcyBmb3IgSElWIGluZmVjdGlvbi4nDQogIGVsc2UgaWYgbm90ICJQYXRpZW50IGhhcyBoYWQgYW4gSElWIFNjcmVlbmluZyIgdGhlbiAnQ0RDIHJlY29tbWVuZHMgdGhhdCBkaWFnbm9zdGljIEhJViB0ZXN0aW5nIGFuZCBvcHQtb3V0IEhJViBzY3JlZW5pbmcgYmUgYSBwYXJ0IG9mIHJvdXRpbmUgY2xpbmljYWwgY2FyZSBpbiBhbGwgaGVhbHRoLWNhcmUgc2V0dGluZ3Mgd2hpbGUgYWxzbyBwcmVzZXJ2aW5nIHRoZSBwYXRpZW50cyBvcHRpb24gdG8gZGVjbGluZSBISVYgdGVzdGluZyBhbmQgZW5zdXJpbmcgYSBwcm92aWRlci1wYXRpZW50IHJlbGF0aW9uc2hpcCBjb25kdWNpdmUgdG8gb3B0aW1hbCBjbGluaWNhbCBhbmQgcHJldmVudGl2ZSBjYXJlLicNCiAgZWxzZSAnUGF0aWVudHMgc2hvdWxkIGJlIGluZm9ybWVkIG9yYWxseSBvciBpbiB3cml0aW5nIHRoYXQgSElWIHRlc3Rpbmcgd2lsbCBiZSBwZXJmb3JtZWQgdW5sZXNzIHRoZXkgZGVjbGluZSAob3B0LW91dCBzY3JlZW5pbmcpLiBPcmFsIG9yIHdyaXR0ZW4gaW5mb3JtYXRpb24gc2hvdWxkIGluY2x1ZGUgYW4gZXhwbGFuYXRpb24gb2YgSElWIGluZmVjdGlvbiBhbmQgdGhlIG1lYW5pbmdzIG9mIHBvc2l0aXZlIGFuZCBuZWdhdGl2ZSB0ZXN0IHJlc3VsdHMsIGFuZCB0aGUgcGF0aWVudCBzaG91bGQgYmUgb2ZmZXJlZCBhbiBvcHBvcnR1bml0eSB0byBhc2sgcXVlc3Rpb25zIGFuZCB0byBkZWNsaW5lIHRlc3RpbmcuDQogICBXaXRoIHN1Y2ggbm90aWZpY2F0aW9uLCBjb25zZW50IGZvciBISVYgc2NyZWVuaW5nIHNob3VsZCBiZSBpbmNvcnBvcmF0ZWQgaW50byB0aGUgcGF0aWVudHMgZ2VuZXJhbCBpbmZvcm1lZCBjb25zZW50IGZvciBtZWRpY2FsIGNhcmUgb24gdGhlIHNhbWUgYmFzaXMgYXMgYXJlIG90aGVyIHNjcmVlbmluZyBvciBkaWFnbm9zdGljIHRlc3RzOyBhIHNlcGFyYXRlIGNvbnNlbnQgZm9ybSBmb3IgSElWIHRlc3RpbmcgaXMgbm90IHJlY29tbWVuZGVkLicNCg0KZGVmaW5lICJJbmRpY2F0b3IgU3RhdHVzIjoNCiAgaWYgIlBhdGllbnQgaXMgYSBTZXh1YWxseSBBY3RpdmUgTVNNIHdobyBzaG91bGQgYmUgU2NyZWVuZWQgRXZlcnkgMyBNb250aHMiIHRoZW4gIldhcm5pbmciDQogIGVsc2UgaWYgIlBhdGllbnQgaXMgYSBTZXh1YWxseSBBY3RpdmUgTVNNIHdobyBzaG91bGQgYmUgU2NyZWVuZWQgQW5udWFsbHkiIHRoZW4gIldhcm5pbmciDQogIGVsc2UgaWYgIlBhdGllbnQgaXMgYXQgRmlyc3QgUHJlbmF0YWwgVmlzaXQiIHRoZW4gIkluZm8iDQogIGVsc2UgaWYgIlBhdGllbnQgaXMgSGlnaCBSaXNrIGluIFRoaXJkIFRyaW1lc3RlciBvZiBQcmVnbmFuY3kiIHRoZW4gIldhcm5pbmciDQogIGVsc2UgaWYgIlBhdGllbnQgaXMgU2Vla2luZyBUcmVhdG1lbnQgZm9yIGFuIFNURCIgdGhlbiAiSW5mbyINCiAgZWxzZSBpZiBub3QgIlBhdGllbnQgaGFzIGhhZCBhbiBISVYgU2NyZWVuaW5nIiB0aGVuICJXYXJuaW5nIg0KICBlbHNlICJJbmZvIg0KDQpkZWZpbmUgIkV4Y2x1c2lvbiBSZWFzb24iOg0KICBpZiAiTWVldHMgRXhjbHVzaW9uIENyaXRlcmlhIiB0aGVuDQogICAgKA0KICAgICAgJ1BhdGllbnQgd2FzIGV4Y2x1ZGVkIGZyb20gSElWIFNjcmVlbmluZyAnDQogICAgICArICgNCiAgICAgICAgICBpZiBub3QgIlBhdGllbnQgaXMgYmV0d2VlbiAxMyBhbmQgNjQgeWVhcnMgb2xkIiB0aGVuICdkdWUgdG8gbm90IGJlaW5nIGJldHdlZW4gdGhlIGFnZXMgb2YgMTMgYW5kIDY0LicNCiAgICAgICAgICBlbHNlIGlmICJBY3RpdmUgRGlhZ25vc2lzIG9mIEhJViBEdXJpbmcgUGF0aWVudCBWaXNpdCIgaXMgbm90IG51bGwgdGhlbiAnZHVlIHRvIHRoZSBwYXRpZW50IGFscmVhZHkgaGF2aW5nIGJlZW4gZGlhZ25vc2VkIHdpdGggSElWLicNCiAgICAgICAgICBlbHNlICcnDQogICAgICAgICkNCiAgICApDQogIGVsc2UgJycNCg0KDQovKiBISVYgU2NyZWVuaW5nIFdvcmtmbG93ICovDQovLyBQYXRpZW50IFZpc2l0IE9jY3VycmVkDQpkZWZpbmUgIlBhdGllbnQgRW5jb3VudGVyIjoNCiAgTGFzdCgNCiAgICAoSEMuUXVhbGlmaWVkRW5jb3VudGVycygNCiAgICAgIEhERS4iUGF0aWVudCBFbmNvdW50ZXIiDQogICAgICB1bmlvbiBIREUuIlByZWduYW5jeSBFbmNvdW50ZXJzIg0KICAgICAgdW5pb24gSERFLiJUaGlyZCBUcmltZXN0ZXIgRW5jb3VudGVycyINCiAgICApKSBQYXRpZW50RW5jb3VudGVyDQogICAgc29ydCBieSBlbmQgb2YgcGVyaW9kKQ0KDQoNCi8qIERldGVybWluZSBQYXRpZW50IENoYXJhY3RlcmlzdGljcyBhbmQgVGVzdGluZyBDcml0ZXJpYSAqLw0KZGVmaW5lICJQYXRpZW50IGlzIGJldHdlZW4gMTMgYW5kIDY0IHllYXJzIG9sZCI6DQogIEFnZUluWWVhcnNBdChlbmQgb2YgIlBhdGllbnQgRW5jb3VudGVyIi5wZXJpb2QpID49IDEzDQogIGFuZCBBZ2VJblllYXJzQXQoZW5kIG9mICJQYXRpZW50IEVuY291bnRlciIucGVyaW9kKSA8PSA2NA0KDQpkZWZpbmUgIkFjdGl2ZSBEaWFnbm9zaXMgb2YgSElWIER1cmluZyBQYXRpZW50IFZpc2l0IjoNCiAgKExhc3QoDQogICAgKEhDLlF1YWxpZmllZENvbmRpdGlvbnMoSERFLiJISVYgRGlhZ25vc2lzIikpIEhJVkRpYWdub3Npcw0KICAgICAgc29ydCBieSBlbmQgb2YgRkMuVG9JbnRlcnZhbChhYmF0ZW1lbnQpDQogICkpIEhJVkRpYWdub3Npcw0KICAgIHdpdGggIlBhdGllbnQgRW5jb3VudGVyIiBQYXRpZW50RW5jb3VudGVyDQogICAgICBzdWNoIHRoYXQgRkMuVG9QcmV2YWxlbmNlSW50ZXJ2YWwoSElWRGlhZ25vc2lzKSBvdmVybGFwcyBQYXRpZW50RW5jb3VudGVyLnBlcmlvZA0KDQpkZWZpbmUgIkhJViBTY3JlZW5pbmcgVGVzdCI6DQogICgNCiAgICBIQy5RdWFsaWZpZWRPYnNlcnZhdGlvbnMoSERFLiJISVYgVGVzdCIpDQogICAgdW5pb24gSEMuUXVhbGlmaWVkT2JzZXJ2YXRpb25zKEhERS4iUHJldmlvdXMgSElWIFNjcmVlbmluZyIpDQogICkgSElWU2NyZWVuaW5nDQogICAgd2l0aCAiUGF0aWVudCBFbmNvdW50ZXIiIFBhdGllbnRFbmNvdW50ZXINCiAgICAgIHN1Y2ggdGhhdCBGQy5Ub0ludGVydmFsKEhJVlNjcmVlbmluZy5lZmZlY3RpdmUpIGJlZm9yZSBQYXRpZW50RW5jb3VudGVyLnBlcmlvZA0KDQpkZWZpbmUgIlBhdGllbnQgaGFzIGhhZCBhbiBISVYgU2NyZWVuaW5nIjoNCiAgZXhpc3RzKCJISVYgU2NyZWVuaW5nIFRlc3QiKQ0KDQpkZWZpbmUgIlByZXZpb3VzIEhJViBTY3JlZW5pbmcgVGVzdCI6DQogIGZyb20NCiAgKA0KICAgIExhc3QoIkhJViBTY3JlZW5pbmcgVGVzdCIgSElWVGVzdA0KICAgICAgc29ydCBieSBlbmQgb2YgRkMuVG9JbnRlcnZhbChlZmZlY3RpdmUpKQ0KICApIE1vc3RSZWNlbnRISVZUZXN0LA0KICAiUGF0aWVudCBFbmNvdW50ZXIiIFBhdGllbnRFbmNvdW50ZXINCiAgICB3aGVyZSBGQy5Ub0ludGVydmFsKE1vc3RSZWNlbnRISVZUZXN0LmVmZmVjdGl2ZSkgYmVmb3JlIFBhdGllbnRFbmNvdW50ZXIucGVyaW9kDQoNCmRlZmluZSAiQW1vdW50IG9mIERheXMgU2luY2UgUHJldmlvdXMgSElWIFNjcmVlbmluZyI6DQogICJQcmV2aW91cyBISVYgU2NyZWVuaW5nIFRlc3QiIEhJVlRlc3QNCiAgICByZXR1cm4gZHVyYXRpb24gaW4gZGF5cyBiZXR3ZWVuIGVuZCBvZiBGQy5Ub0ludGVydmFsKEhJVlRlc3QuTW9zdFJlY2VudEhJVlRlc3QuZWZmZWN0aXZlKSBhbmQgZW5kIG9mIEhJVlRlc3QuUGF0aWVudEVuY291bnRlci5wZXJpb2QNCg0KZGVmaW5lICJPdmVyIGEgWWVhciBoYXMgUGFzdCBTaW5jZSBQcmV2aW91cyBISVYgU2NyZWVuaW5nIjoNCiAgIlByZXZpb3VzIEhJViBTY3JlZW5pbmcgVGVzdCIgSElWVGVzdA0KICAgIHJldHVybiAoZHVyYXRpb24gaW4geWVhcnMgYmV0d2VlbiBlbmQgb2YgRkMuVG9JbnRlcnZhbChISVZUZXN0Lk1vc3RSZWNlbnRISVZUZXN0LmVmZmVjdGl2ZSkgYW5kIGVuZCBvZiBISVZUZXN0LlBhdGllbnRFbmNvdW50ZXIucGVyaW9kKSA+PSAxDQoNCmRlZmluZSAiT3ZlciAzIE1vbnRocyBoYXMgUGFzdCBTaW5jZSBQcmV2aW91cyBISVYgU2NyZWVuaW5nIjoNCiAgIlByZXZpb3VzIEhJViBTY3JlZW5pbmcgVGVzdCIgSElWVGVzdA0KICAgIHJldHVybiAoZHVyYXRpb24gaW4gbW9udGhzIGJldHdlZW4gZW5kIG9mIEZDLlRvSW50ZXJ2YWwoSElWVGVzdC5Nb3N0UmVjZW50SElWVGVzdC5lZmZlY3RpdmUpIGFuZCBlbmQgb2YgSElWVGVzdC5QYXRpZW50RW5jb3VudGVyLnBlcmlvZCkgPj0gMw0KDQpkZWZpbmUgIlBhdGllbnQgaGFzIFJlY2VpdmVkIFByZSBFeHBvc3VyZSBQcm9waHlsYXhpcyI6DQogIGV4aXN0cygNCiAgICBIQy5RdWFsaWZpZWRNZWRpY2F0aW9uUmVxdWVzdHMoSERFLiJQcmUgRXhwb3N1cmUgUHJvcGh5bGF4aXMgTWVkaWNhdGlvbiBQcmVzY3JpcHRpb25zIikNCiAgICB1bmlvbiBIQy5RdWFsaWZpZWRNZWRpY2F0aW9uRGlzcGVuc2VzKEhERS4iUHJlIEV4cG9zdXJlIFByb3BoeWxheGlzIERpc3BlbnNlZCBNZWRpY2F0aW9ucyIpDQogICAgdW5pb24gSEMuUXVhbGlmaWVkT2JzZXJ2YXRpb25zKEhERS4iUHJldmlvdXMgZXhwZXJpZW5jZSB3aXRoIFBSRVAiKQ0KICApIFByRVANCg0KDQovKiBEZXRlcm1pbmUgUGF0aWVudCdzIENhdGVnb3J5IChnZW5kZXIsIHByZWduYW5jeSwgTVNNLCBzZXh1YWwgYWN0aXZpdHksIGV0YykgKi8NCmRlZmluZSAiUGF0aWVudCBpcyBNYWxlIjoNCiAgaWYgUGF0aWVudC5nZW5kZXIgPSAnbWFsZScgdGhlbiB0cnVlIGVsc2UgZmFsc2UNCg0KZGVmaW5lICJQYXRpZW50IGlzIEZlbWFsZSI6DQogIGlmIFBhdGllbnQuZ2VuZGVyID0gJ2ZlbWFsZScgdGhlbiB0cnVlIGVsc2UgZmFsc2UNCg0KZGVmaW5lICJQYXRpZW50IGlzIFByZWduYW50IjoNCiAgZXhpc3RzKA0KICAgIChIQy5RdWFsaWZpZWRDb25kaXRpb25zKEhERS4iUHJlZ25hbmN5IENvbmRpdGlvbnMiKSkgUHJlZ25hbmN5DQogICAgICB3aXRoICJQYXRpZW50IEVuY291bnRlciIgUGF0aWVudEVuY291bnRlcg0KICAgICAgICBzdWNoIHRoYXQgRkMuVG9QcmV2YWxlbmNlSW50ZXJ2YWwoUHJlZ25hbmN5KSBvdmVybGFwcyBQYXRpZW50RW5jb3VudGVyLnBlcmlvZA0KICApDQoNCmRlZmluZSAiU2V4dWFsbHkgQWN0aXZlIE1TTSBQYXRpZW50IjoNCiAgaWYgIlBhdGllbnQgaXMgTWFsZSIgdGhlbg0KICAgICgNCiAgICAgIGV4aXN0cygNCiAgICAgICAgKEhDLlF1YWxpZmllZE9ic2VydmF0aW9ucyhIREUuIlNleHVhbCBBY3Rpdml0eSAtIE1lbiIpKSBNU01PYnNlcnZlZA0KICAgICAgICAgIHdpdGggIlBhdGllbnQgRW5jb3VudGVyIiBQYXRpZW50RW5jb3VudGVyDQogICAgICAgICAgICBzdWNoIHRoYXQgRkMuVG9JbnRlcnZhbChNU01PYnNlcnZlZC5lZmZlY3RpdmUpIG92ZXJsYXBzIFBhdGllbnRFbmNvdW50ZXIucGVyaW9kDQogICAgICApDQogICAgKQ0KICBlbHNlIGZhbHNlDQoNCg0KLyogRGV0ZXJtaW5lIFBhdGllbnQncyBSaXNrIExldmVsIChIaWdoIFJpc2ssIE5vcm1hbCBSaXNrLCBOb25lLCBldGMpICovDQovLyBQcmVkb21pbmFudGx5IGJhc2VkIG9mZiBlbGVtZW50cyBidWlsdCBmcm9tIHRoZSByaXNrLWZhY3RvcnMgcXVlc3Rpb25uYWlyZQ0KLy8gUklTS1M6IFNUSXMsIEluamVjdGlvbiBEcnVnIFVzZSwgU2V4IHBhcnRuZXIgaGFzIEhJViwgU2V4IEV4Y2hhbmdlZCBmb3IgRHJ1Z3MvTW9uZXksIE1vcmUgdGhhbiAxIFBhcnRuZXIgc2luY2UgcHJldmlvdXMgc2NyZWVuaW5nIChmb3IgdGhlbXNlbHZlcyBvciB0aGVpciBwYXJ0bmVycykNCg0KLy8gSGlnaCBSaXNrIC0tIE90aGVyIFNUSXMNCmRlZmluZSAiQWN0aXZlIERpYWdub3NpcyBvZiBIQ1YgRHVyaW5nIFBhdGllbnQgVmlzaXQiOg0KICAoDQogICAgKExhc3QoDQogICAgICAoSEMuUXVhbGlmaWVkQ29uZGl0aW9ucyhIREUuIkhlcGF0aXRpcyBDIERpYWdub3NpcyIpKSBIQ1ZEaWFnbm9zaXMNCiAgICAgICAgc29ydCBieSBlbmQgb2YgRkMuVG9JbnRlcnZhbChhYmF0ZW1lbnQpKQ0KICAgICkgSENWRGlhZ25vc2lzDQogICAgd2l0aCAiUGF0aWVudCBFbmNvdW50ZXIiIFBhdGllbnRFbmNvdW50ZXINCiAgICAgIHN1Y2ggdGhhdCBGQy5Ub1ByZXZhbGVuY2VJbnRlcnZhbChIQ1ZEaWFnbm9zaXMpIG92ZXJsYXBzIFBhdGllbnRFbmNvdW50ZXIucGVyaW9kDQogICkgaXMgbm90IG51bGwNCiAgb3IgZXhpc3RzKA0KICAgIChIQy5RdWFsaWZpZWRPYnNlcnZhdGlvbnMoSERFLiJQYXRpZW50IERpYWdub3NlZCB3aXRoIEhDViIpKSBIQ1ZPYnNlcnZlZA0KICAgICAgd2l0aCAiUGF0aWVudCBFbmNvdW50ZXIiIFBhdGllbnRFbmNvdW50ZXINCiAgICAgICAgc3VjaCB0aGF0IEZDLlRvSW50ZXJ2YWwoSENWT2JzZXJ2ZWQuZWZmZWN0aXZlKSBvdmVybGFwcyBQYXRpZW50RW5jb3VudGVyLnBlcmlvZA0KICApDQoNCmRlZmluZSAiQWN0aXZlIERpYWdub3NpcyBvZiBTeXBoaWxpcyBEdXJpbmcgUGF0aWVudCBWaXNpdCI6DQogICgNCiAgICAoTGFzdCgNCiAgICAgIChIQy5RdWFsaWZpZWRDb25kaXRpb25zKEhERS4iU3lwaGlsaXMgRGlhZ25vc2lzIikpIFN5cGhpbGlzRGlhZ25vc2lzDQogICAgICAgIHNvcnQgYnkgZW5kIG9mIEZDLlRvSW50ZXJ2YWwoYWJhdGVtZW50KSkNCiAgICApIFN5cGhpbGlzRGlhZ25vc2lzDQogICAgd2l0aCAiUGF0aWVudCBFbmNvdW50ZXIiIFBhdGllbnRFbmNvdW50ZXINCiAgICAgIHN1Y2ggdGhhdCBGQy5Ub1ByZXZhbGVuY2VJbnRlcnZhbChTeXBoaWxpc0RpYWdub3Npcykgb3ZlcmxhcHMgUGF0aWVudEVuY291bnRlci5wZXJpb2QNCiAgKSBpcyBub3QgbnVsbA0KICBvciBleGlzdHMoDQogICAgKEhDLlF1YWxpZmllZE9ic2VydmF0aW9ucyhIREUuIlBhdGllbnQgRGlhZ25vc2VkIHdpdGggU3lwaGlsaXMiKSkgU3lwaGlsaXNPYnNlcnZlZA0KICAgICAgd2l0aCAiUGF0aWVudCBFbmNvdW50ZXIiIFBhdGllbnRFbmNvdW50ZXINCiAgICAgICAgc3VjaCB0aGF0IEZDLlRvSW50ZXJ2YWwoU3lwaGlsaXNPYnNlcnZlZC5lZmZlY3RpdmUpIG92ZXJsYXBzIFBhdGllbnRFbmNvdW50ZXIucGVyaW9kDQogICkNCg0KZGVmaW5lICJBY3RpdmUgRGlhZ25vc2lzIG9mIEdvbm9ycmhlYSBEdXJpbmcgUGF0aWVudCBWaXNpdCI6DQogICgNCiAgICAoTGFzdCgNCiAgICAgIChIQy5RdWFsaWZpZWRDb25kaXRpb25zKEhERS4iR29ub3JyaGVhIERpYWdub3NpcyIpKSBHb25vcnJoZWFEaWFnbm9zaXMNCiAgICAgICAgc29ydCBieSBlbmQgb2YgRkMuVG9JbnRlcnZhbChhYmF0ZW1lbnQpKQ0KICAgICkgR29ub3JyaGVhRGlhZ25vc2lzDQogICAgd2l0aCAiUGF0aWVudCBFbmNvdW50ZXIiIFBhdGllbnRFbmNvdW50ZXINCiAgICAgIHN1Y2ggdGhhdCBGQy5Ub1ByZXZhbGVuY2VJbnRlcnZhbChHb25vcnJoZWFEaWFnbm9zaXMpIG92ZXJsYXBzIFBhdGllbnRFbmNvdW50ZXIucGVyaW9kDQogICkgaXMgbm90IG51bGwNCiAgb3IgZXhpc3RzKA0KICAgIChIQy5RdWFsaWZpZWRPYnNlcnZhdGlvbnMoSERFLiJQYXRpZW50IERpYWdub3NlZCB3aXRoIEdvbm9ycmhlYSIpKSBHb25vcnJoZWFPYnNlcnZlZA0KICAgICAgd2l0aCAiUGF0aWVudCBFbmNvdW50ZXIiIFBhdGllbnRFbmNvdW50ZXINCiAgICAgICAgc3VjaCB0aGF0IEZDLlRvSW50ZXJ2YWwoR29ub3JyaGVhT2JzZXJ2ZWQuZWZmZWN0aXZlKSBvdmVybGFwcyBQYXRpZW50RW5jb3VudGVyLnBlcmlvZA0KICApDQoNCmRlZmluZSAiQWN0aXZlIERpYWdub3NpcyBvZiBDaGxhbXlkaWEgRHVyaW5nIFBhdGllbnQgVmlzaXQiOg0KICAoDQogICAgKExhc3QoDQogICAgICAoSEMuUXVhbGlmaWVkQ29uZGl0aW9ucyhIREUuIkNobGFteWRpYSBEaWFnbm9zaXMiKSkgQ2hsYW15ZGlhRGlhZ25vc2lzDQogICAgICAgIHNvcnQgYnkgZW5kIG9mIEZDLlRvSW50ZXJ2YWwoYWJhdGVtZW50KSkNCiAgICApIENobGFteWRpYURpYWdub3Npcw0KICAgIHdpdGggIlBhdGllbnQgRW5jb3VudGVyIiBQYXRpZW50RW5jb3VudGVyDQogICAgICBzdWNoIHRoYXQgRkMuVG9QcmV2YWxlbmNlSW50ZXJ2YWwoQ2hsYW15ZGlhRGlhZ25vc2lzKSBvdmVybGFwcyBQYXRpZW50RW5jb3VudGVyLnBlcmlvZA0KICApIGlzIG5vdCBudWxsDQogIG9yIGV4aXN0cygNCiAgICAoSEMuUXVhbGlmaWVkT2JzZXJ2YXRpb25zKEhERS4iUGF0aWVudCBEaWFnbm9zZWQgd2l0aCBDaGxhbXlkaWEiKSkgQ2hsYW15ZGlhT2JzZXJ2ZWQNCiAgICAgIHdpdGggIlBhdGllbnQgRW5jb3VudGVyIiBQYXRpZW50RW5jb3VudGVyDQogICAgICAgIHN1Y2ggdGhhdCBGQy5Ub0ludGVydmFsKENobGFteWRpYU9ic2VydmVkLmVmZmVjdGl2ZSkgb3ZlcmxhcHMgUGF0aWVudEVuY291bnRlci5wZXJpb2QNCiAgKQ0KDQpkZWZpbmUgIlBhdGllbnQgaXMgYXQgSGlnaCBSaXNrIER1ZSB0byBhIFNURCI6DQogICJBY3RpdmUgRGlhZ25vc2lzIG9mIEhDViBEdXJpbmcgUGF0aWVudCBWaXNpdCINCiAgb3IgIkFjdGl2ZSBEaWFnbm9zaXMgb2YgU3lwaGlsaXMgRHVyaW5nIFBhdGllbnQgVmlzaXQiDQogIG9yICJBY3RpdmUgRGlhZ25vc2lzIG9mIEdvbm9ycmhlYSBEdXJpbmcgUGF0aWVudCBWaXNpdCINCiAgb3IgIkFjdGl2ZSBEaWFnbm9zaXMgb2YgQ2hsYW15ZGlhIER1cmluZyBQYXRpZW50IFZpc2l0Ig0KDQovLyBIaWdoIFJpc2sgLS0gSW5qZWN0aW9uIERydWcgVXNlDQovLyBOT1RFOiBXaGF0IGlzIGNvbnNpZGVyZWQgYW4gQWN0aXZlIFRpbWUgUGVyaW9kIGZvciBJbmplY3Rpb24gRHJ1ZyBVc2U/DQpkZWZpbmUgIlBhdGllbnQgaXMgYXQgSGlnaCBSaXNrIER1ZSB0byBJbmplY3Rpb24gRHJ1ZyBVc2UiOg0KICAoDQogICAgKExhc3QoDQogICAgICAoDQogICAgICAgIEhDLlF1YWxpZmllZFByb2NlZHVyZXMoSERFLiJEcnVnIFJlaGFiaWxpdGF0aW9uIikNCiAgICAgICAgdW5pb24gSEMuUXVhbGlmaWVkT2JzZXJ2YXRpb25zKEhERS4iSW5qZWN0aW9uIEZpbmRpbmdzIikNCiAgICAgICAgdW5pb24gSEMuUXVhbGlmaWVkQ29uZGl0aW9ucyhIREUuIkluamVjdGlvbiBEcnVnIFVzZSBEaWFnbm9zaXMiKQ0KICAgICAgICB1bmlvbiBIQy5RdWFsaWZpZWRNZWRpY2F0aW9uU3RhdGVtZW50cyhIREUuIkluamVjdGlvbiBEcnVnIFVzZSIpDQogICAgICAgIHVuaW9uIEhDLlF1YWxpZmllZE9ic2VydmF0aW9ucyhIREUuIlBhdGllbnQgaGFzIHVzZWQgSW5qZWN0aW9uIERydWdzIikNCiAgICAgICkgSW5qZWN0aW9uRHJ1Z1VzZQ0KICAgICAgICAgIHJldHVybiBUdXBsZSB7DQogICAgICAgICAgICByZXNvdXJjZTogSW5qZWN0aW9uRHJ1Z1VzZSwNCiAgICAgICAgICAgIElEVVRpbWluZzogQ29hbGVzY2UoDQogICAgICAgICAgICAgIGVuZCBvZiBGQy5Ub0ludGVydmFsKEluamVjdGlvbkRydWdVc2UucGVyZm9ybWVkKSwgZW5kIG9mIEZDLlRvSW50ZXJ2YWwoSW5qZWN0aW9uRHJ1Z1VzZS5lZmZlY3RpdmUpLCBlbmQgb2YgRkMuVG9QcmV2YWxlbmNlSW50ZXJ2YWwoSW5qZWN0aW9uRHJ1Z1VzZSkNCiAgICAgICAgICAgICkgfSBzb3J0IGJ5IElEVVRpbWluZykucmVzb3VyY2UNCiAgICApIEluamVjdGlvbkRydWdVc2UNCiAgICB3aXRoICJQYXRpZW50IEVuY291bnRlciIgUGF0aWVudEVuY291bnRlcg0KICAgICAgc3VjaCB0aGF0IENvYWxlc2NlKEZDLlRvSW50ZXJ2YWwoSW5qZWN0aW9uRHJ1Z1VzZS5wZXJmb3JtZWQpLCBGQy5Ub0ludGVydmFsKEluamVjdGlvbkRydWdVc2UuZWZmZWN0aXZlKSwgRkMuVG9QcmV2YWxlbmNlSW50ZXJ2YWwoSW5qZWN0aW9uRHJ1Z1VzZSkpIG92ZXJsYXBzIFBhdGllbnRFbmNvdW50ZXIucGVyaW9kDQogICkgaXMgbm90IG51bGwNCg0KLy8gSGlnaCBSaXNrIC0tIFBhcnRuZXIgd2l0aCBISVYNCmRlZmluZSAiUGF0aWVudCBpcyBhdCBIaWdoIFJpc2sgRHVlIHRvIFNleHVhbCBQYXJ0bmVyIGhhdmluZyBISVYiOg0KICBleGlzdHMoDQogICAgKEhDLlF1YWxpZmllZE9ic2VydmF0aW9ucyhIREUuIlNleHVhbCBBY3Rpdml0eSAtIFBhcnRuZXJzIEhJViBIaXN0b3J5IikpIEhJVlBhcnRuZXJIaXN0b3J5DQogICAgICB3aXRoICJQYXRpZW50IEVuY291bnRlciIgUGF0aWVudEVuY291bnRlcg0KICAgICAgICBzdWNoIHRoYXQgRkMuVG9JbnRlcnZhbChISVZQYXJ0bmVySGlzdG9yeS5lZmZlY3RpdmUpIG92ZXJsYXBzIFBhdGllbnRFbmNvdW50ZXIucGVyaW9kDQogICkNCg0KLy8gSGlnaCBSaXNrIC0tIFNleCBFeGNoYW5nZWQgZm9yIERydWdzL01vbmV5DQpkZWZpbmUgIlBhdGllbnQgaXMgYXQgSGlnaCBSaXNrIER1ZSB0byBleGNoYW5naW5nIHNleCBmb3IgbW9uZXkgYW5kL29yIGRydWdzIjoNCiAgZXhpc3RzKA0KICAgIChIQy5RdWFsaWZpZWRPYnNlcnZhdGlvbnMoSERFLiJTZXh1YWwgQWN0aXZpdHkgLSBFeGNoYW5nZWQgZm9yIFNleCIpKSBTZXhFeGNoYW5nZWQNCiAgICAgIHdpdGggIlBhdGllbnQgRW5jb3VudGVyIiBQYXRpZW50RW5jb3VudGVyDQogICAgICAgIHN1Y2ggdGhhdCBGQy5Ub0ludGVydmFsKFNleEV4Y2hhbmdlZC5lZmZlY3RpdmUpIG92ZXJsYXBzIFBhdGllbnRFbmNvdW50ZXIucGVyaW9kDQogICkNCg0KLy8gSGlnaCBSaXNrIC0tIE11bHRpcGxlIFNleCBQYXJ0bmVycyBzaW5jZSBwcmV2aW91cyBISVYgU2NyZWVuaW5nIGZvciBQYXRpZW50IG9yIHRoZWlyIHBhcnRuZXINCmRlZmluZSAiUGF0aWVudCBpcyBhdCBIaWdoIFJpc2sgRHVlIHRvIE11bHRpcGxlIFNleCBQYXJ0bmVycyBzaW5jZSBsYXN0IHNjcmVlbmluZyI6DQogICgNCiAgICAoTGFzdCgNCiAgICAgICgNCiAgICAgICAgSEMuUXVhbGlmaWVkT2JzZXJ2YXRpb25zKEhERS4iSElWIFRlc3QiKQ0KICAgICAgICB1bmlvbiBIQy5RdWFsaWZpZWRPYnNlcnZhdGlvbnMoSERFLiJQcmV2aW91cyBISVYgU2NyZWVuaW5nIikNCiAgICAgICkgSElWU2NyZWVuaW5nDQogICAgICBzb3J0IGJ5IGVuZCBvZiBGQy5Ub0ludGVydmFsKGVmZmVjdGl2ZSkNCiAgKSkgSElWU2NyZWVuaW5nDQogICAgd2l0aCAoDQogICAgICBIQy5RdWFsaWZpZWRPYnNlcnZhdGlvbnMoSERFLiJTZXh1YWwgQWN0aXZpdHkgLSBOdW1iZXIgb2YgUGFydG5lcnMiKQ0KICAgICAgdW5pb24gSEMuUXVhbGlmaWVkT2JzZXJ2YXRpb25zKEhERS4iU2V4dWFsIEFjdGl2aXR5IC0gUGFydG5lcnMgTnVtYmVyIG9mIFBhcnRuZXJzIikNCiAgICApIE51bWJlck9mUGFydG5lcnMNCiAgICAgIHN1Y2ggdGhhdCBGQy5Ub0ludGVydmFsKEhJVlNjcmVlbmluZy5lZmZlY3RpdmUpIGJlZm9yZSBGQy5Ub0ludGVydmFsKE51bWJlck9mUGFydG5lcnMuZWZmZWN0aXZlKQ0KICApIGlzIG5vdCBudWxsDQoNCmRlZmluZSAiUGF0aWVudCBpcyBhdCBIaWdoIFJpc2sgZm9yIEhJViI6DQogICJQYXRpZW50IGlzIGF0IEhpZ2ggUmlzayBEdWUgdG8gYSBTVEQiDQogIG9yICJQYXRpZW50IGlzIGF0IEhpZ2ggUmlzayBEdWUgdG8gSW5qZWN0aW9uIERydWcgVXNlIg0KICBvciAiUGF0aWVudCBpcyBhdCBIaWdoIFJpc2sgRHVlIHRvIFNleHVhbCBQYXJ0bmVyIGhhdmluZyBISVYiDQogIG9yICJQYXRpZW50IGlzIGF0IEhpZ2ggUmlzayBEdWUgdG8gZXhjaGFuZ2luZyBzZXggZm9yIG1vbmV5IGFuZC9vciBkcnVncyINCiAgb3IgIlBhdGllbnQgaXMgYXQgSGlnaCBSaXNrIER1ZSB0byBNdWx0aXBsZSBTZXggUGFydG5lcnMgc2luY2UgbGFzdCBzY3JlZW5pbmciDQoNCg0KLyogV29tZW4gJiBNZW4gV29ya2Zsb3cgKi8NCi8vIEFsbCBXb21lbiBhbmQgTWVuIGJldHdlZW4gdGhlIGFnZXMgMTMtNjQgYW5kL29yIHRob3NlIHdobyBhcmUgc2Vla2luZyB0cmVhdG1lbnQgZm9yIGFuIFNURA0KZGVmaW5lICJQYXRpZW50IGlzIFNlZWtpbmcgVHJlYXRtZW50IGZvciBhbiBTVEQiOg0KICBleGlzdHMoDQogICAgKEhDLlF1YWxpZmllZE9ic2VydmF0aW9ucyhIREUuIlNlZWtpbmcgU1REIFRyZWF0bWVudCIpKSBTZWVraW5nVHJlYXRtZW50DQogICAgICB3aXRoICJQYXRpZW50IEVuY291bnRlciIgUGF0aWVudEVuY291bnRlcg0KICAgICAgICBzdWNoIHRoYXQgRkMuVG9JbnRlcnZhbChTZWVraW5nVHJlYXRtZW50LmVmZmVjdGl2ZSkgb3ZlcmxhcHMgUGF0aWVudEVuY291bnRlci5wZXJpb2QNCiAgKQ0KDQoNCi8qIFByZWduYW50IFdvbWVuIFdvcmtmbG93ICovDQovLyBBbGwgV29tZW4gc2hvdWxkIGJlIHNjcmVlbmVkIGF0IEluaXRpYWwgUHJlbmF0YWwgVmlzaXQNCi8vIEFsbCB3b21lbiBzaG91bGQgYmUgcmV0ZXN0ZWQgaW4gdGhlIHRoaXJkIHRyaW1lc3RlciBpZiB0aGV5J3JlIGhpZ2ggcmlzaw0KLy8gTk9URTogVGhpcyBkZWZpbml0aW9uIGltcGxlbWVudGF0aW9uIGlzIG5haXZlIGFuZCBkb2VzIG5vdCB0YWtlIGludG8gZWZmZWN0IG11bHRpcGxlIHByZWduYW5jaWVzLiBDb25zaWRlciB1c2Ugb2YgYW4gRXBpc29kZU9mQ2FyZSByZXNvdXJjZS4NCmRlZmluZSAiUGF0aWVudCBpcyBhdCBGaXJzdCBQcmVuYXRhbCBWaXNpdCI6DQogICgNCiAgICAoRmlyc3QoDQogICAgICAoSEMuUXVhbGlmaWVkRW5jb3VudGVycyhIREUuIlByZWduYW5jeSBFbmNvdW50ZXJzIikpIFByZWduYW5jeUVuY291bnRlcg0KICAgICAgc29ydCBieSBlbmQgb2YgcGVyaW9kDQogICAgKSkgUHJlZ25hbmN5RW5jb3VudGVyDQogICAgICB3aXRoICJQYXRpZW50IEVuY291bnRlciIgUGF0aWVudEVuY291bnRlcg0KICAgICAgICBzdWNoIHRoYXQgUHJlZ25hbmN5RW5jb3VudGVyLmlkID0gUGF0aWVudEVuY291bnRlci5pZA0KICApIGlzIG5vdCBudWxsDQoNCmRlZmluZSAiUGF0aWVudCBpcyBpbiBUaGlyZCBUcmltZXN0ZXIgb2YgUHJlZ25hbmN5IjoNCiAgKA0KICAgIChMYXN0KA0KICAgICAgKEhDLlF1YWxpZmllZEVuY291bnRlcnMoSERFLiJUaGlyZCBUcmltZXN0ZXIgRW5jb3VudGVycyIpKSBUaGlyZFRyaW1lc3RlckVuY291bnRlcg0KICAgIHNvcnQgYnkgZW5kIG9mIHBlcmlvZA0KICAgICkpIFRoaXJkVHJpbWVzdGVyRW5jb3VudGVyDQogICAgICB3aXRoICJQYXRpZW50IEVuY291bnRlciIgUGF0aWVudEVuY291bnRlcg0KICAgICAgICBzdWNoIHRoYXQgVGhpcmRUcmltZXN0ZXJFbmNvdW50ZXIuaWQgPSBQYXRpZW50RW5jb3VudGVyLmlkDQogICkgaXMgbm90IG51bGwNCg0KZGVmaW5lICJQYXRpZW50IGlzIEhpZ2ggUmlzayBpbiBUaGlyZCBUcmltZXN0ZXIgb2YgUHJlZ25hbmN5IjoNCiAgIlBhdGllbnQgaXMgYXQgSGlnaCBSaXNrIGZvciBISVYiDQogIGFuZCAiUGF0aWVudCBpcyBpbiBUaGlyZCBUcmltZXN0ZXIgb2YgUHJlZ25hbmN5Ig0KDQoNCi8qIE1TTSAoTWVuIHdobyBoYXZlIHNleCB3aXRoIG1lbikgKi8NCi8vIEF0IExlYXN0IEFubnVhbGx5IGZvciBzZXh1YWxseSBhY3RpdmUgTVNNIGlmIEhJViBzdGF0dXMgaXNuJ3QgcG9zaXRpdmUgYW5kIGlmIHBhdGllbnQvcGFydG5lciBoYXMgaGFkIG1vcmUgdGhhbiAxIHBhcnRuZXIgc2luY2UgcHJldmlvdXMgc2NyZWVuaW5nDQovLyBGb3Igc2V4dWFsbHkgYWN0aXZlIE1TTSBUZXN0cyBzaG91bGQgb2NjdXIgZXZlcnkgMyBtb250aHMgaWYgdGhlIHBhdGllbnQgaGFzIGV4cGVyaWVuY2VkIHByZXANCmRlZmluZSAiUGF0aWVudCBpcyBhIFNleHVhbGx5IEFjdGl2ZSBNU00gd2l0aG91dCBISVYiOg0KICAiU2V4dWFsbHkgQWN0aXZlIE1TTSBQYXRpZW50Ig0KICBhbmQgIkFjdGl2ZSBEaWFnbm9zaXMgb2YgSElWIER1cmluZyBQYXRpZW50IFZpc2l0IiBpcyBudWxsDQoNCmRlZmluZSAiUGF0aWVudCBpcyBhIFNleHVhbGx5IEFjdGl2ZSBNU00gd2l0aCBNdWx0aXBsZSBTZXggUGFydG5lcnMiOg0KICAiU2V4dWFsbHkgQWN0aXZlIE1TTSBQYXRpZW50Ig0KICBhbmQgIlBhdGllbnQgaXMgYXQgSGlnaCBSaXNrIER1ZSB0byBNdWx0aXBsZSBTZXggUGFydG5lcnMgc2luY2UgbGFzdCBzY3JlZW5pbmciDQoNCmRlZmluZSAiUGF0aWVudCBpcyBhIFNleHVhbGx5IEFjdGl2ZSBNU00gd2hvIHNob3VsZCBiZSBTY3JlZW5lZCBBbm51YWxseSI6DQogICJQYXRpZW50IGlzIGEgU2V4dWFsbHkgQWN0aXZlIE1TTSB3aXRob3V0IEhJViINCiAgYW5kICJQYXRpZW50IGlzIGEgU2V4dWFsbHkgQWN0aXZlIE1TTSB3aXRoIE11bHRpcGxlIFNleCBQYXJ0bmVycyINCiAgYW5kICJPdmVyIGEgWWVhciBoYXMgUGFzdCBTaW5jZSBQcmV2aW91cyBISVYgU2NyZWVuaW5nIg0KDQpkZWZpbmUgIlBhdGllbnQgaXMgYSBTZXh1YWxseSBBY3RpdmUgTVNNIHdobyBzaG91bGQgYmUgU2NyZWVuZWQgRXZlcnkgMyBNb250aHMiOg0KICAiU2V4dWFsbHkgQWN0aXZlIE1TTSBQYXRpZW50Ig0KICBhbmQgIlBhdGllbnQgaGFzIFJlY2VpdmVkIFByZSBFeHBvc3VyZSBQcm9waHlsYXhpcyINCiAgYW5kICJPdmVyIDMgTW9udGhzIGhhcyBQYXN0IFNpbmNlIFByZXZpb3VzIEhJViBTY3JlZW5pbmciDQo="
      } ]
    },
    "request": {
      "method": "PUT",
      "url": "Library/Screening"
    }
  }, {
    "resource": {
      "resourceType": "Observation",
      "id": "MSMPatient-observation-msm-2",
      "meta": {
        "profile": [ "http://fhir.org/guides/nachc/hiv-cds/StructureDefinition/nachc-h1-de13" ]
      },
      "status": "preliminary",
      "code": {
        "coding": [ {
          "system": "http://fhir.org/guides/nachc/hiv-cds/CodeSystem/hiv-custom",
          "code": "Whether the patient has been sexually active with men",
          "display": "Whether the patient has been sexually active with men"
        } ]
      },
      "subject": {
        "reference": "Patient/MSMPatient"
      },
      "encounter": {
        "reference": "Encounter/MSMPatient-encounter-1"
      },
      "effectiveDateTime": "2021-07-31T10:30:00-07:00",
      "valueBoolean": true
    },
    "request": {
      "method": "PUT",
      "url": "Observation/MSMPatient-observation-msm-2"
    }
  }, {
    "resource": {
      "resourceType": "Encounter",
      "id": "ExclusionPatient-encounter-1",
      "meta": {
        "profile": [ "http://fhir.org/guides/nachc/hiv-cds/StructureDefinition/nachc-a0-de1" ]
      },
      "status": "in-progress",
      "class": {
        "system": "http://terminology.hl7.org/CodeSystem/v3-ActCode",
        "code": "AMB",
        "display": "ambulatory"
      },
      "type": [ {
        "coding": [ {
          "system": "http://fhir.org/guides/nachc/hiv-cds/CodeSystem/hiv-custom",
          "code": "Patient Encounter-99205",
          "display": "99205"
        } ]
      } ],
      "subject": {
        "reference": "Patient/ExclusionPatient"
      },
      "period": {
        "start": "2021-05-10T14:00:00-07:00",
        "end": "2021-05-10T15:20:00-07:00"
      }
    },
    "request": {
      "method": "PUT",
      "url": "Encounter/ExclusionPatient-encounter-1"
    }
  }, {
    "resource": {
      "resourceType": "Encounter",
      "id": "HighRiskIDUPatient-encounter-1",
      "meta": {
        "profile": [ "http://fhir.org/guides/nachc/hiv-cds/StructureDefinition/nachc-a0-de1" ]
      },
      "status": "in-progress",
      "class": {
        "system": "http://terminology.hl7.org/CodeSystem/v3-ActCode",
        "code": "AMB",
        "display": "ambulatory"
      },
      "type": [ {
        "coding": [ {
          "system": "http://fhir.org/guides/nachc/hiv-cds/CodeSystem/hiv-custom",
          "code": "Patient Encounter-99205",
          "display": "99205"
        } ]
      } ],
      "subject": {
        "reference": "Patient/HighRiskIDUPatient"
      },
      "period": {
        "start": "2021-07-08T08:00:00-07:00",
        "end": "2021-07-08T09:20:00-07:00"
      }
    },
    "request": {
      "method": "PUT",
      "url": "Encounter/HighRiskIDUPatient-encounter-1"
    }
  }, {
    "resource": {
      "resourceType": "Condition",
      "id": "HighRiskPregnantPatient-condition-pregnant-1",
      "meta": {
        "profile": [ "http://fhir.org/guides/nachc/hiv-cds/StructureDefinition/nachc-a1-de1" ]
      },
      "clinicalStatus": {
        "coding": [ {
          "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
          "version": "0.5.0",
          "code": "active",
          "display": "Active"
        } ]
      },
      "verificationStatus": {
        "coding": [ {
          "system": "http://terminology.hl7.org/ValueSet/condition-ver-status",
          "version": "0.5.0",
          "code": "confirmed",
          "display": "Confirmed"
        } ]
      },
      "category": [ {
        "coding": [ {
          "system": "http://terminology.hl7.org/ValueSet/condition-category",
          "version": "0.5.0",
          "code": "encounter-diagnosis",
          "display": "Encounter Diagnosis"
        } ]
      } ],
      "code": {
        "coding": [ {
          "system": "http://fhir.org/guides/nachc/hiv-cds/CodeSystem/hiv-custom",
          "code": "Pregnancy Conditions-Z33.3",
          "display": "Z33.3"
        } ]
      },
      "subject": {
        "reference": "Patient/HighRiskPregnantPatient"
      },
      "onsetDateTime": "2021-01-10T12:00:00-07:00"
    },
    "request": {
      "method": "PUT",
      "url": "Condition/HighRiskPregnantPatient-condition-pregnant-1"
    }
  }, {
    "resource": {
      "resourceType": "Observation",
      "id": "HighRiskPregnantPatient-observation-screening-1",
      "meta": {
        "profile": [ "http://fhir.org/guides/nachc/hiv-cds/StructureDefinition/nachc-a2-de1" ]
      },
      "status": "final",
      "code": {
        "coding": [ {
          "system": "http://fhir.org/guides/nachc/hiv-cds/CodeSystem/hiv-custom",
          "code": "HIV Test",
          "display": "HIV Test"
        } ]
      },
      "subject": {
        "reference": "Patient/HighRiskPregnantPatient"
      },
      "effectiveDateTime": "2021-02-08T10:20:00-07:00",
      "valueCodeableConcept": {
        "coding": [ {
          "system": "http://fhir.org/guides/nachc/hiv-cds/CodeSystem/hiv-custom",
          "code": "HIV Test-41145-4",
          "display": "41145-4"
        } ]
      }
    },
    "request": {
      "method": "PUT",
      "url": "Observation/HighRiskPregnantPatient-observation-screening-1"
    }
  }, {
    "resource": {
      "resourceType": "Encounter",
      "id": "InclusionPatient-encounter-1",
      "meta": {
        "profile": [ "http://fhir.org/guides/nachc/hiv-cds/StructureDefinition/nachc-a0-de1" ]
      },
      "status": "in-progress",
      "class": {
        "system": "http://terminology.hl7.org/CodeSystem/v3-ActCode",
        "code": "AMB",
        "display": "ambulatory"
      },
      "type": [ {
        "coding": [ {
          "system": "http://fhir.org/guides/nachc/hiv-cds/CodeSystem/hiv-custom",
          "code": "Patient Encounter-99205",
          "display": "99205"
        } ]
      } ],
      "subject": {
        "reference": "Patient/InclusionPatient"
      },
      "period": {
        "start": "2021-05-10T12:00:00-07:00",
        "end": "2021-05-10T13:20:00-07:00"
      }
    },
    "request": {
      "method": "PUT",
      "url": "Encounter/InclusionPatient-encounter-1"
    }
  }, {
    "resource": {
      "resourceType": "Encounter",
      "id": "HighRiskPregnantPatient-encounter-1",
      "meta": {
        "profile": [ "http://fhir.org/guides/nachc/hiv-cds/StructureDefinition/nachc-f2-de38" ]
      },
      "status": "in-progress",
      "class": {
        "system": "http://terminology.hl7.org/CodeSystem/v3-ActCode",
        "code": "AMB",
        "display": "ambulatory"
      },
      "type": [ {
        "coding": [ {
          "system": "http://fhir.org/guides/nachc/hiv-cds/CodeSystem/hiv-custom",
          "code": "Third Trimester Encounters-Z34.83",
          "display": "Z34.83"
        } ]
      } ],
      "subject": {
        "reference": "Patient/HighRiskPregnantPatient"
      },
      "period": {
        "start": "2021-07-30T10:00:00-07:00",
        "end": "2021-07-30T11:20:00-07:00"
      }
    },
    "request": {
      "method": "PUT",
      "url": "Encounter/HighRiskPregnantPatient-encounter-1"
    }
  }, {
    "resource": {
      "resourceType": "Observation",
      "id": "MSMPatient-observation-screening-1",
      "meta": {
        "profile": [ "http://fhir.org/guides/nachc/hiv-cds/StructureDefinition/nachc-a2-de1" ]
      },
      "status": "final",
      "code": {
        "coding": [ {
          "system": "http://fhir.org/guides/nachc/hiv-cds/CodeSystem/hiv-custom",
          "code": "HIV Test",
          "display": "HIV Test"
        } ]
      },
      "subject": {
        "reference": "Patient/MSMPatient"
      },
      "effectiveDateTime": "2020-06-08T10:20:00-07:00",
      "valueCodeableConcept": {
        "coding": [ {
          "system": "http://fhir.org/guides/nachc/hiv-cds/CodeSystem/hiv-custom",
          "code": "HIV Test-25835-0",
          "display": "25835-0"
        } ]
      }
    },
    "request": {
      "method": "PUT",
      "url": "Observation/MSMPatient-observation-screening-1"
    }
  }, {
    "resource": {
      "resourceType": "PlanDefinition",
      "id": "plandefinition-Screening",
      "url": "http://fhir.org/guides/nachc/hiv-cds/PlanDefinition/plandefinition-Screening",
      "identifier": [ {
        "use": "official",
        "value": "nachc-Screening"
      } ],
      "version": "1.0.0",
      "name": "Screening",
      "title": "CDC HIV Screening",
      "type": {
        "coding": [ {
          "system": "http://terminology.hl7.org/CodeSystem/plan-definition-type",
          "code": "eca-rule",
          "display": "ECA Rule"
        } ]
      },
      "status": "draft",
      "date": "2021-07-31T00:00:00-08:00",
      "publisher": "National Association of Community Health Centers, Inc. (NACHC)",
      "description": "This PlanDefinition defines a a Clinical Decision Support CDC Recommendation for HIV Screening",
      "useContext": [ {
        "code": {
          "system": "http://terminology.hl7.org/CodeSystem/usage-context-type",
          "version": "4.0.1",
          "code": "focus",
          "display": "Clinical Focus"
        },
        "valueCodeableConcept": {
          "coding": [ {
            "system": "http://hl7.org/fhir/sid/icd-10-cm",
            "version": "2021",
            "code": "B20",
            "display": "Human immunodeficiency virus [HIV] disease"
          } ]
        }
      } ],
      "jurisdiction": [ {
        "coding": [ {
          "system": "http://hl7.org/fhir/ValueSet/iso3166-1-3",
          "version": "4.0.1",
          "code": "USA",
          "display": "United States of America"
        } ]
      } ],
      "purpose": "The purpose of this is to identify and build CDS support for HIV Screening.",
      "usage": "This is to be used in conjunction with a patient-facing FHIR application.",
      "copyright": "© Copyright National Association of Community Health Centers, Inc. (NACHC) 2021+.",
      "topic": [ {
        "coding": [ {
          "system": "http://terminology.hl7.org/CodeSystem/definition-topic",
          "version": "4.0.1",
          "code": "assessment",
          "display": "Assessment"
        } ],
        "text": "HIV Management"
      } ],
      "library": [ "http://fhir.org/guides/nachc/hiv-cds/Library/Screening" ],
      "action": [ {
        "title": "HIV Screening",
        "documentation": [ {
          "type": "documentation",
          "display": "Info for those with HIV",
          "url": "https://www.cdc.gov/hiv/guidelines/testing.html"
        } ],
        "trigger": [ {
          "type": "named-event",
          "name": "patient-view"
        } ],
        "condition": [ {
          "kind": "start",
          "expression": {
            "language": "text/cql",
            "expression": "'true'"
          }
        } ],
        "dynamicValue": [ {
          "path": "action.description",
          "expression": {
            "description": "Patient Name.",
            "language": "text/cql.identifier",
            "expression": "Patient Name"
          }
        }, {
          "path": "action.extension",
          "expression": {
            "language": "text/cql.identifier",
            "expression": "Info"
          }
        } ],
        "action": [ {
          "title": "Recommendation",
          "description": "Determines type of recommendation regarding status of HIV Screening.",
          "condition": [ {
            "kind": "applicability",
            "expression": {
              "description": "Determine if Patient is in screening population.",
              "language": "text/cql.identifier",
              "expression": "In Population"
            }
          } ],
          "dynamicValue": [ {
            "path": "action.title",
            "expression": {
              "description": "Determines what recommendation patient should be provided.",
              "language": "text/cql.identifier",
              "expression": "Recommendation"
            }
          }, {
            "path": "action.description",
            "expression": {
              "description": "Rationale for recommendation type.",
              "language": "text/cql.identifier",
              "expression": "Rationale"
            }
          }, {
            "path": "action.extension",
            "expression": {
              "language": "text/cql.identifier",
              "expression": "Indicator Status"
            }
          } ]
        }, {
          "title": "Exclusion from HIV Screening",
          "description": "Determines if patient was excluded from HIV Screening Recommendation.",
          "condition": [ {
            "kind": "applicability",
            "expression": {
              "description": "Determine if Patient is in hiv exclusion population.",
              "language": "text/cql.identifier",
              "expression": "Meets Exclusion Criteria"
            }
          } ],
          "dynamicValue": [ {
            "path": "action.description",
            "expression": {
              "description": "Rationale for why patient was excluded from the hiv screening.",
              "language": "text/cql.identifier",
              "expression": "Exclusion Reason"
            }
          }, {
            "path": "action.extension",
            "expression": {
              "language": "text/cql.identifier",
              "expression": "Info"
            }
          } ]
        } ]
      } ]
    },
    "request": {
      "method": "PUT",
      "url": "PlanDefinition/plandefinition-Screening"
    }
  }, {
    "resource": {
      "resourceType": "Condition",
      "id": "HighRiskSTDPatient-condition-hcv-1",
      "meta": {
        "profile": [ "http://fhir.org/guides/nachc/hiv-cds/StructureDefinition/nachc-a1-de1" ]
      },
      "clinicalStatus": {
        "coding": [ {
          "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
          "version": "0.5.0",
          "code": "active",
          "display": "Active"
        } ]
      },
      "verificationStatus": {
        "coding": [ {
          "system": "http://terminology.hl7.org/ValueSet/condition-ver-status",
          "version": "0.5.0",
          "code": "confirmed",
          "display": "Confirmed"
        } ]
      },
      "category": [ {
        "coding": [ {
          "system": "http://terminology.hl7.org/ValueSet/condition-category",
          "version": "0.5.0",
          "code": "encounter-diagnosis",
          "display": "Encounter Diagnosis"
        } ]
      } ],
      "code": {
        "coding": [ {
          "system": "http://fhir.org/guides/nachc/hiv-cds/CodeSystem/hiv-custom",
          "code": "Hepatitis C Diagnosis-B17.1",
          "display": "B17.1"
        } ]
      },
      "subject": {
        "reference": "Patient/HighRiskSTDPatient"
      },
      "onsetDateTime": "2020-07-10T14:00:00-07:00",
      "abatementDateTime": "2021-07-10T14:00:00-07:00"
    },
    "request": {
      "method": "PUT",
      "url": "Condition/HighRiskSTDPatient-condition-hcv-1"
    }
  }, {
    "resource": {
      "resourceType": "Patient",
      "id": "ExclusionPatient",
      "meta": {
        "profile": [ "http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-patient" ]
      },
      "identifier": [ {
        "use": "usual",
        "type": {
          "coding": [ {
            "system": "http://terminology.hl7.org/CodeSystem/v2-0203",
            "code": "MR"
          } ]
        },
        "system": "urn:oid:1.2.36.146.595.217.0.1",
        "value": "12345",
        "period": {
          "start": "2001-05-06"
        },
        "assigner": {
          "display": "Acme Healthcare"
        }
      } ],
      "active": true,
      "name": [ {
        "use": "official",
        "family": "Merryweather",
        "given": [ "Sally" ]
      } ],
      "gender": "female",
      "birthDate": "1994-11-22",
      "deceasedBoolean": false
    },
    "request": {
      "method": "PUT",
      "url": "Patient/ExclusionPatient"
    }
  }, {
    "resource": {
      "resourceType": "Observation",
      "id": "HighRiskPregnantPatient-observation-multiple-2",
      "meta": {
        "profile": [ "http://fhir.org/guides/nachc/hiv-cds/StructureDefinition/nachc-h1-de15" ]
      },
      "status": "preliminary",
      "code": {
        "coding": [ {
          "system": "http://fhir.org/guides/nachc/hiv-cds/CodeSystem/hiv-custom",
          "code": "Whether the patient has had more than 1 partner since previous HIV test",
          "display": "Whether the patient has had more than 1 partner since previous HIV test"
        } ]
      },
      "subject": {
        "reference": "Patient/HighRiskPregnantPatient"
      },
      "encounter": {
        "reference": "Encounter/HighRiskSTDPatient-encounter-1"
      },
      "effectiveDateTime": "2021-07-30T10:30:00-07:00",
      "valueBoolean": true
    },
    "request": {
      "method": "PUT",
      "url": "Observation/HighRiskPregnantPatient-observation-multiple-2"
    }
  }, {
    "resource": {
      "resourceType": "Patient",
      "id": "HighRiskPregnantPatient",
      "meta": {
        "profile": [ "http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-patient" ]
      },
      "identifier": [ {
        "use": "usual",
        "type": {
          "coding": [ {
            "system": "http://terminology.hl7.org/CodeSystem/v2-0203",
            "code": "MR"
          } ]
        },
        "system": "urn:oid:1.2.36.146.595.217.0.1",
        "value": "12345",
        "period": {
          "start": "2001-05-06"
        },
        "assigner": {
          "display": "Acme Healthcare"
        }
      } ],
      "active": true,
      "name": [ {
        "use": "official",
        "family": "Coraline",
        "given": [ "Beatrix" ]
      } ],
      "gender": "female",
      "birthDate": "1989-01-12",
      "deceasedBoolean": false
    },
    "request": {
      "method": "PUT",
      "url": "Patient/HighRiskPregnantPatient"
    }
  }, {
    "resource": {
      "resourceType": "Observation",
      "id": "MSMPatient-observation-multiple-3",
      "meta": {
        "profile": [ "http://fhir.org/guides/nachc/hiv-cds/StructureDefinition/nachc-h1-de18" ]
      },
      "status": "preliminary",
      "code": {
        "coding": [ {
          "system": "http://fhir.org/guides/nachc/hiv-cds/CodeSystem/hiv-custom",
          "code": "Whether the patient’s partner has had more than 1 partner since previous HIV Test",
          "display": "Whether the patient’s partner has had more than 1 partner since previous HIV Test"
        } ]
      },
      "subject": {
        "reference": "Patient/MSMPatient"
      },
      "encounter": {
        "reference": "Encounter/MSMPatient-encounter-1"
      },
      "effectiveDateTime": "2021-07-31T10:30:00-07:00",
      "valueBoolean": true
    },
    "request": {
      "method": "PUT",
      "url": "Observation/MSMPatient-observation-multiple-3"
    }
  }, {
    "resource": {
      "resourceType": "Condition",
      "id": "HighRiskIDUPatient-condition-hcv-1",
      "meta": {
        "profile": [ "http://fhir.org/guides/nachc/hiv-cds/StructureDefinition/nachc-a1-de1" ]
      },
      "clinicalStatus": {
        "coding": [ {
          "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
          "version": "0.5.0",
          "code": "active",
          "display": "Active"
        } ]
      },
      "verificationStatus": {
        "coding": [ {
          "system": "http://terminology.hl7.org/ValueSet/condition-ver-status",
          "version": "0.5.0",
          "code": "confirmed",
          "display": "Confirmed"
        } ]
      },
      "category": [ {
        "coding": [ {
          "system": "http://terminology.hl7.org/ValueSet/condition-category",
          "version": "0.5.0",
          "code": "encounter-diagnosis",
          "display": "Encounter Diagnosis"
        } ]
      } ],
      "code": {
        "coding": [ {
          "system": "http://fhir.org/guides/nachc/hiv-cds/CodeSystem/hiv-custom",
          "code": "Injection Drug Use Diagnosis-L98.8",
          "display": "L98.8"
        } ]
      },
      "subject": {
        "reference": "Patient/HighRiskIDUPatient"
      },
      "onsetDateTime": "2018-07-10T14:00:00-07:00"
    },
    "request": {
      "method": "PUT",
      "url": "Condition/HighRiskIDUPatient-condition-hcv-1"
    }
  }, {
    "resource": {
      "resourceType": "Patient",
      "id": "MSMPatient",
      "meta": {
        "profile": [ "http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-patient" ]
      },
      "identifier": [ {
        "use": "usual",
        "type": {
          "coding": [ {
            "system": "http://terminology.hl7.org/CodeSystem/v2-0203",
            "code": "MR"
          } ]
        },
        "system": "urn:oid:1.2.36.146.595.217.0.1",
        "value": "12345",
        "period": {
          "start": "2001-05-06"
        },
        "assigner": {
          "display": "Acme Healthcare"
        }
      } ],
      "active": true,
      "name": [ {
        "use": "official",
        "family": "Kotic",
        "given": [ "Joe" ]
      } ],
      "gender": "male",
      "birthDate": "1972-06-09",
      "deceasedBoolean": false
    },
    "request": {
      "method": "PUT",
      "url": "Patient/MSMPatient"
    }
  }, {
    "resource": {
      "resourceType": "Encounter",
      "id": "HighRiskSTDPatient-encounter-1",
      "meta": {
        "profile": [ "http://fhir.org/guides/nachc/hiv-cds/StructureDefinition/nachc-a0-de1" ]
      },
      "status": "in-progress",
      "class": {
        "system": "http://terminology.hl7.org/CodeSystem/v3-ActCode",
        "code": "AMB",
        "display": "ambulatory"
      },
      "type": [ {
        "coding": [ {
          "system": "http://fhir.org/guides/nachc/hiv-cds/CodeSystem/hiv-custom",
          "code": "Patient Encounter-99205",
          "display": "99205"
        } ]
      } ],
      "subject": {
        "reference": "Patient/HighRiskSTDPatient"
      },
      "period": {
        "start": "2021-07-08T10:00:00-07:00",
        "end": "2021-07-08T11:20:00-07:00"
      }
    },
    "request": {
      "method": "PUT",
      "url": "Encounter/HighRiskSTDPatient-encounter-1"
    }
  }, {
    "resource": {
      "resourceType": "Observation",
      "id": "HighRiskSTDPatient-observation-seeking-1",
      "meta": {
        "profile": [ "http://fhir.org/guides/nachc/hiv-cds/StructureDefinition/nachc-h1-de9" ]
      },
      "status": "preliminary",
      "code": {
        "coding": [ {
          "system": "http://fhir.org/guides/nachc/hiv-cds/CodeSystem/hiv-custom",
          "code": "Whether the patient is currently seeking evaluation and treatment for an STD",
          "display": "Whether the patient is currently seeking evaluation and treatment for an STD"
        } ]
      },
      "subject": {
        "reference": "Patient/HighRiskSTDPatient"
      },
      "encounter": {
        "reference": "Encounter/HighRiskSTDPatient-encounter-1"
      },
      "effectiveDateTime": "2021-07-08T10:20:00-07:00",
      "valueBoolean": true
    },
    "request": {
      "method": "PUT",
      "url": "Observation/HighRiskSTDPatient-observation-seeking-1"
    }
  }, {
    "resource": {
      "resourceType": "Patient",
      "id": "InclusionPatient",
      "meta": {
        "profile": [ "http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-patient" ]
      },
      "identifier": [ {
        "use": "usual",
        "type": {
          "coding": [ {
            "system": "http://terminology.hl7.org/CodeSystem/v2-0203",
            "code": "MR"
          } ]
        },
        "system": "urn:oid:1.2.36.146.595.217.0.1",
        "value": "12345",
        "period": {
          "start": "2001-05-06"
        },
        "assigner": {
          "display": "Acme Healthcare"
        }
      } ],
      "active": true,
      "name": [ {
        "use": "official",
        "family": "Chalmers",
        "given": [ "Peter", "James" ]
      }, {
        "use": "usual",
        "family": "Chalmers",
        "given": [ "Jim" ]
      }, {
        "use": "maiden",
        "family": "Windsor",
        "given": [ "Peter", "James" ],
        "period": {
          "end": "2002"
        }
      } ],
      "telecom": [ {
        "system": "phone",
        "value": "(03) 5555 6473",
        "use": "work",
        "rank": 1
      }, {
        "system": "phone",
        "value": "(03) 3410 5613",
        "use": "mobile",
        "rank": 2
      }, {
        "system": "phone",
        "value": "(03) 5555 8834",
        "use": "old",
        "period": {
          "end": "2014"
        }
      } ],
      "gender": "male",
      "birthDate": "1974-12-25",
      "deceasedBoolean": false,
      "address": [ {
        "use": "home",
        "type": "both",
        "text": "534 Erewhon St PeasantVille, Utah 84414",
        "line": [ "534 Erewhon St" ],
        "city": "PleasantVille",
        "district": "Rainbow",
        "state": "UT",
        "postalCode": "84414",
        "period": {
          "start": "1974-12-25"
        }
      } ],
      "contact": [ {
        "relationship": [ {
          "coding": [ {
            "system": "http://terminology.hl7.org/CodeSystem/v2-0131",
            "code": "N"
          } ]
        } ],
        "name": {
          "family": "du Marché",
          "_family": {
            "extension": [ {
              "url": "http://hl7.org/fhir/StructureDefinition/humanname-own-prefix",
              "valueString": "VV"
            } ]
          },
          "given": [ "Bénédicte" ]
        },
        "telecom": [ {
          "system": "phone",
          "value": "+33 (237) 998327"
        } ],
        "address": {
          "use": "home",
          "type": "both",
          "line": [ "534 Erewhon St" ],
          "city": "PleasantVille",
          "district": "Rainbow",
          "state": "VT",
          "postalCode": "3999",
          "period": {
            "start": "1974-12-25"
          }
        },
        "gender": "female",
        "period": {
          "start": "2012"
        }
      } ],
      "managingOrganization": {
        "reference": "Organization/example"
      }
    },
    "request": {
      "method": "PUT",
      "url": "Patient/InclusionPatient"
    }
  }, {
    "resource": {
      "resourceType": "Condition",
      "id": "ExclusionPatient-condition-hiv-1",
      "meta": {
        "profile": [ "http://fhir.org/guides/nachc/hiv-cds/StructureDefinition/nachc-a1-de1" ]
      },
      "clinicalStatus": {
        "coding": [ {
          "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
          "version": "0.5.0",
          "code": "active",
          "display": "Active"
        } ]
      },
      "verificationStatus": {
        "coding": [ {
          "system": "http://terminology.hl7.org/ValueSet/condition-ver-status",
          "version": "0.5.0",
          "code": "confirmed",
          "display": "Confirmed"
        } ]
      },
      "category": [ {
        "coding": [ {
          "system": "http://terminology.hl7.org/ValueSet/condition-category",
          "version": "0.5.0",
          "code": "encounter-diagnosis",
          "display": "Encounter Diagnosis"
        } ]
      } ],
      "code": {
        "coding": [ {
          "system": "http://fhir.org/guides/nachc/hiv-cds/CodeSystem/hiv-custom",
          "code": "HIV Diagnosis-62479008",
          "display": "62479008"
        } ]
      },
      "subject": {
        "reference": "Patient/ExclusionPatient"
      },
      "onsetDateTime": "2014-01-10T14:00:00-07:00",
      "abatementDateTime": "2021-07-10T14:00:00-07:00"
    },
    "request": {
      "method": "PUT",
      "url": "Condition/ExclusionPatient-condition-hiv-1"
    }
  }, {
    "resource": {
      "resourceType": "Patient",
      "id": "HighRiskIDUPatient",
      "meta": {
        "profile": [ "http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-patient" ]
      },
      "identifier": [ {
        "use": "usual",
        "type": {
          "coding": [ {
            "system": "http://terminology.hl7.org/CodeSystem/v2-0203",
            "code": "MR"
          } ]
        },
        "system": "urn:oid:1.2.36.146.595.217.0.1",
        "value": "12345",
        "period": {
          "start": "2001-05-06"
        },
        "assigner": {
          "display": "Acme Healthcare"
        }
      } ],
      "active": true,
      "name": [ {
        "use": "official",
        "family": "Madelyn",
        "given": [ "Ashley" ]
      } ],
      "gender": "female",
      "birthDate": "2002-02-02",
      "deceasedBoolean": false
    },
    "request": {
      "method": "PUT",
      "url": "Patient/HighRiskIDUPatient"
    }
  } ]
}